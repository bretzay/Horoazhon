{% extends 'base.html.twig' %}

{% block title %}Biens immobiliers{% endblock %}

{% block body %}
<div class="page-header">
    <h1>Biens immobiliers</h1>
</div>

<form method="GET" class="filters">
    <div class="form-group">
        <label>Ville</label>
        <input type="text" name="ville" value="{{ filters.ville ?? '' }}">
    </div>
    <div class="form-group">
        <label>Type</label>
        <select name="type">
            <option value="">Tous</option>
            <option value="APPARTEMENT" {{ (filters.type ?? '') == 'APPARTEMENT' ? 'selected' }}>Appartement</option>
            <option value="MAISON" {{ (filters.type ?? '') == 'MAISON' ? 'selected' }}>Maison</option>
            <option value="STUDIO" {{ (filters.type ?? '') == 'STUDIO' ? 'selected' }}>Studio</option>
            <option value="TERRAIN" {{ (filters.type ?? '') == 'TERRAIN' ? 'selected' }}>Terrain</option>
        </select>
    </div>
    <div class="form-group">
        <label>Annonce</label>
        <select name="annonce">
            <option value="">Toutes</option>
            <option value="vente" {{ (filters.annonce ?? '') == 'vente' ? 'selected' }}>En vente</option>
            <option value="location" {{ (filters.annonce ?? '') == 'location' ? 'selected' }}>En location</option>
        </select>
    </div>
    <div class="form-group">
        <label>Prix min</label>
        <input type="number" name="prixMin" value="{{ filters.prixMin ?? '' }}">
    </div>
    <div class="form-group">
        <label>Prix max</label>
        <input type="number" name="prixMax" value="{{ filters.prixMax ?? '' }}">
    </div>
    <div class="form-group">
        <label>Caracteristique</label>
        <select name="caracId">
            <option value="">-</option>
            {% for c in caracteristiques %}
                <option value="{{ c.id }}" {{ (filters.caracId ?? '') == c.id ? 'selected' }}>{{ c.lib }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label>Valeur min</label>
        <input type="number" name="caracMin" value="{{ filters.caracMin ?? '' }}" placeholder="Min">
    </div>
    <div class="form-group">
        <label>Proximite</label>
        <select name="lieuId">
            <option value="">-</option>
            {% for l in lieux %}
                <option value="{{ l.id }}" {{ (filters.lieuId ?? '') == l.id ? 'selected' }}>{{ l.lib }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <label>Max minutes</label>
        <input type="number" name="maxMinutes" value="{{ filters.maxMinutes ?? '' }}" placeholder="Max">
    </div>
    <div class="form-group">
        <label>Transport</label>
        <select name="locomotion">
            <option value="">Tous</option>
            <option value="MARCHE" {{ (filters.locomotion ?? '') == 'MARCHE' ? 'selected' }}>Pied</option>
            <option value="VELO" {{ (filters.locomotion ?? '') == 'VELO' ? 'selected' }}>Velo</option>
            <option value="TRANSPORT_PUBLIC" {{ (filters.locomotion ?? '') == 'TRANSPORT_PUBLIC' ? 'selected' }}>Bus/Metro</option>
            <option value="VOITURE" {{ (filters.locomotion ?? '') == 'VOITURE' ? 'selected' }}>Voiture</option>
        </select>
    </div>
    <button type="submit" class="btn btn-primary">Filtrer</button>
    <a href="{{ path('biens_list') }}" class="btn btn-secondary">Reset</a>
</form>

<div class="property-grid">
    {% for bien in biens %}
    <a href="{{ path('biens_detail', {id: bien.id}) }}" class="property-card" style="color: inherit; text-decoration: none;">
        <div class="info">
            <h3>{{ bien.type ?? 'Bien' }} - {{ bien.ville }}</h3>
            <div class="meta">{{ bien.rue }}, {{ bien.codePostal }} {{ bien.ville }}</div>
            <div class="meta">{{ bien.superficie }} m² {% if bien.ecoScore %} | Eco: {{ bien.ecoScore }}/10{% endif %}</div>
            {% if bien.availableForSale %}
                <span class="badge badge-sale">Vente: {{ bien.salePrice|number_format(0, ',', ' ') }} €</span>
            {% endif %}
            {% if bien.availableForRent %}
                <span class="badge badge-rent">Location: {{ bien.monthlyRent|number_format(0, ',', ' ') }} €/mois</span>
            {% endif %}
            {% if bien.agence %}
                <div class="meta" style="margin-top: 0.5rem;">{{ bien.agence.nom }}</div>
            {% endif %}
        </div>
    </a>
    {% else %}
    <p>Aucun bien ne correspond a vos criteres.</p>
    {% endfor %}
</div>

{% if totalPages > 1 %}
<div class="pagination">
    {% for i in 0..totalPages-1 %}
        {% if i == currentPage %}
            <span class="current">{{ i + 1 }}</span>
        {% else %}
            <a href="{{ path('biens_list', filters|merge({page: i})) }}">{{ i + 1 }}</a>
        {% endif %}
    {% endfor %}
</div>
{% endif %}
{% endblock %}
